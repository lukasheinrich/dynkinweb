<html>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" 
  href="http://www.x3dom.org/x3dom/release/x3dom.css">
</link>
<script type="text/javascript" 
src="http://www.x3dom.org/x3dom/release/x3dom.js">
</script>
<script src="node_modules/d3/d3.js" charset="utf-8"></script>
<script src="node_modules/underscore/underscore.js" charset="utf-8"></script>
<script src="js/m4th.min.js"></script>
<script src="js/numeric-1.2.6.min.js" charset="utf-8"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<style type="text/css" media="screen">
body{
  background-color:#eee;
  margin:auto; 
  color:#111;
  font-family:Helvetica;
}
.coord{
  fill:#eee;
}
.root{
  fill:none;
  stroke:steelblue;
  stroke-width:3;
}
.rootarrow{
  stroke-width:1;
  stroke:steelblue;
}
.fundamental{
  fill:#995555;
}
.fundarrow{
  stroke-width:1;
  stroke:#995555;
}
#content{
  opacity:.75;
  height:100%;
  background-color:#eee;
  margin:auto;      
  position:fixed;
  overflow:scroll;
  z-index:1;
  padding:2em;
  width:300px;
}
#canvas{
   width:100%;
   height:100%
}
#canvasbox{
  overflow-x:hidden;
  overflow-y:hidden;
  margin:auto;
  height:100%;
  width:100%;
  /*      display: table;*/
}
#legend td{
}
#legend svg{
  vertical-align: middle;
}

.dynkindiagram img{
  vertical-align: middle;  
  padding:0;
  margin:0;
}

.dynkin{
  background-color:#eee;
}

#x3dbox{
  width:100%;
  height:100%;
  border:1px solid black;
}

</style>
<title>Lie Algebras of Rank 2 and 3</title>
</head>
<body>
<div id="content">
  <h1>Lattices of Lie Algebras of Rank Two and Three</h1>
  <p>
    Select Dynkin Diagram.
    <form>
      <input type="radio" name="lie" onclick="drawlattices(1*Math.PI/2,Math.sqrt(1));">    
      <span class="dynkindiagram">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/9/9a/Dyn-2.png" width="6" height="24" data-file-width="6" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> 𝖘𝔬₄
    
      <input type="radio" name="lie" onclick="drawlattices(2*Math.PI/3,Math.sqrt(1));">
      <span class="dynkindiagram">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/c/c8/Dyn2-3.png" width="6" height="24" data-file-width="6" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> 𝖘𝔩₃
    
      <br/>
    
      <input type="radio" name="lie" onclick="drawlattices(3*Math.PI/4,Math.sqrt(2));">
      <span class="dynkindiagram">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/4/48/Dyn2-4a.png" width="8" height="24" data-file-width="8" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> 𝖘𝔭₄

      <input type="radio" name="lie" onclick="drawlattices(5*Math.PI/6,Math.sqrt(3));">
      <span class="dynkindiagram" class="dynkin">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/3/38/Dyn2-6a.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> 𝔤₂
      <br/>

      <input type="radio" name="lie" onclick="drawrank3('a3');">
      <span class="dynkindiagram">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/c/c8/Dyn2-3.png" width="8" height="24" data-file-width="8" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/c/c8/Dyn2-3.png" width="6" height="24" data-file-width="6" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> 𝖘𝔬₆≃ 𝖘𝔩₄
      <br/>
      <input type="radio" name="lie" onclick="drawrank3('b3');">
      <span class="dynkindiagram">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/4/48/Dyn2-4a.png" width="8" height="24" data-file-width="8" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/c/c8/Dyn2-3.png" width="6" height="24" data-file-width="6" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> 𝖘𝔬₇
      <br/>
      <input type="radio" name="lie" onclick="drawrank3('c3');">
      <span class="dynkindiagram">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/a/a0/Dyn2-4b.png" width="8" height="24" data-file-width="8" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/c/c8/Dyn2-3.png" width="6" height="24" data-file-width="6" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> 𝖘𝔭₆
      
    </form>
  </p>      
  <p>
    This small demo will draw the fundamental weight lattice as well as the root lattice of the semi-simple Lie algebra associated to the selected Dynkin diagram.
  </p>
  <p>    
    Legend:
    <div id="legend">
      <table>
        <tr><td><svg width=20 height=20><circle cx=10 cy=10 r=2 class="fundamental"></circle></svg> fundamental weight</td></tr>
        <tr><td><svg width=20 height=20><circle cx=10 cy=10 r=5 class="root"></circle></svg> root lattice point</td></tr>
        <tr><td><svg width=20 height=20><line x1=0 y1=10 x2=20 y2=10 class="rootarrow"></circle></svg> root</td></tr>
          <tr><td><svg width=20 height=20><line x1=0 y1=10 x2=20 y2=10 class="fundarrow"></circle></svg> fundamental dominant weight</td></tr>
          </table>
        </div>

      </p>
      <p>
    Various things can be deduced by eye. The index of the root lattice as a sublattice of the fundamental lattice is the center of the universally covering group with that Lie Algebra.
    For G2, for example, we see that the group is centerless. For Spin(4) which has so4 Lie algebra, the center is ℤ₂×ℤ₂ (we can see from the lattices that it must be a finite abelian group of 4 elements, so i could be ℤ₄ or ℤ₂×ℤ₂). Also for 𝖘𝔩₃ we see that the index of the root lattice and weight lattice is 3. I.e. the center of 𝖘𝔩₃ is ℤ₃. Additionally we can only quotient out the entire center since 3 is a prime number already. Therefore there are no intermediate groups between the universal cover and the centerless adjoint group. Finally for 𝖘𝔭₄ we see that the root lattice is twice as large, i.e. the center of Sp(4,ℂ) is ℤ₂.
      </p>
    </p>
    All Groups with the same Lie algebra are constructed as quotients of the universal cover by some central subgroup.  
    <p>    


    </div>
    <div id="canvasbox">
    </div>

    <script type="text/javascript" charset="utf-8">

    aa1 = [1,0]
    aa2 = [-0.5,0.866025]
    
    function cartanelement(beta,alpha){
      if(numeric.dot(alpha,alpha) < 0.01){return 0;}
      return Math.round(2*numeric.dot(beta,alpha)/numeric.dot(alpha,alpha))
    }
    
    function vecinlist(vec,list){
      for(var i=0;i<list.length;i++){
        if(numeric.norm2(numeric.add(vec,numeric.mul(-1,list[i]))) < 0.01){return true;}
      }
      return false
    }
    
    function allroots(simpleroots){
      var roots = simpleroots
      while(true){
        newroots = []
        for(var i=0;i<roots.length;i++){
          var negroot = numeric.mul(-1,roots[i])
          if(!vecinlist(negroot,roots)){roots.push(negroot)}
          //reflect all roots over root i and add string of roots
          for(var j=0;j<roots.length;j++){
            if(Math.abs(1-Math.abs(numeric.dot(roots[i],roots[j])/numeric.norm2(roots[i])/numeric.norm2(roots[j])))>0.1){
              console.log('i:' + i + ' j:' + j)
              nreflect = cartanelement(roots[i],roots[j])
              for(var k=1;k<Math.abs(nreflect)+1;k++){
                reflected = numeric.add(roots[i],numeric.mul(nreflect > 0 ? -k : k,roots[j]))
                console.log('reflected' + reflected)
                if(reflected[0] == 0 && reflected[1] == 0){
                  debugger;
                }
                if(!vecinlist(reflected,roots) && !vecinlist(reflected,newroots)){
                  newroots.push(reflected)
                }
              }
            }
          }
        }
        // debugger;
        console.log('newroots')
        console.log(newroots.length)
        if(!newroots.length){break;}
        roots = roots.concat(newroots)
      }
      return roots
    }


    function rotate(angle){
      return [[Math.cos(angle),-Math.sin(angle)],[Math.sin(angle),Math.cos(angle)]];
    }

    function drawlattices(angle,scale){
      d3.selectAll('x3d').remove()
      if($('#canvas').length == 0){
        d3.select('#canvasbox').append('svg').attr('id','canvas')
      }
      var canvas = d3.selectAll('#canvas')

      var pxwidth   = $('#canvas').width()
      var pxheight   = $('#canvas').height()

      var physwidth = 10
      var physheight = physwidth/pxwidth*pxheight

      var xscale = d3.scale.linear().domain([-physwidth/2,physwidth/2]).range([0,pxwidth]);
      var yscale = d3.scale.linear().domain([-physheight/2,physheight/2]).range([pxheight,0]);

      a1 = [1,0]
      a2 = numeric.mul(scale,numeric.dot(rotate(angle),a1))
     

      simpleroots = [a1,a2]
      var cartanmatrix = _.range(2).map(function(i){return _.range(2).map(function(j){
        return 2*numeric.dot(simpleroots[i],simpleroots[j])/numeric.dot(simpleroots[j],simpleroots[j]);
      })})

      fundamentalroots = numeric.dot(numeric.inv(cartanmatrix),simpleroots)

      var rootgrid = _.range(-2*physwidth,2*physwidth).map(function(i){return _.range(-2*physwidth,2*physwidth).map(function(j){
        return numeric.add(numeric.mul(i,a1),numeric.mul(j,a2))
      })})
      rootgrid = _.flatten(rootgrid,true)

      var fundamentalgrid = _.range(-2*physwidth,2*physwidth).map(function(i){return _.range(-2*physwidth,2*physwidth).map(function(j){
        return numeric.add(numeric.mul(i,fundamentalroots[0]),numeric.mul(j,fundamentalroots[1]))
      })})
      fundamentalgrid = _.flatten(fundamentalgrid,true)


      animtime = 750
     
      var fundamentalmarker = canvas.selectAll('.fundamental').data(fundamentalgrid)
      fundamentalmarker.enter().append('circle')

      fundamentalmarker
      .transition().duration(animtime).ease("elastic")
      .attr('cx',function(d){return xscale(d[0])})
      .attr('cy',function(d){return yscale(d[1])})
      .attr('r',2)
      .attr('class','fundamental')
               
      var rootsmarker = canvas.selectAll('.root').data(rootgrid)
      rootsmarker.enter().append('circle')
        
      rootsmarker
      .transition().duration(animtime).ease("elastic")
      .attr('cx',function(d){return xscale(d[0])})
      .attr('cy',function(d){return yscale(d[1])})
      .attr('r',5)
      .attr('class','root');
        
      console.log(allroots(simpleroots))
      var rootarrows = canvas.selectAll('.rootarrow').data(allroots(simpleroots))
      rootarrows.enter().append('line')
      rootarrows.exit().remove()
        
      rootarrows
      .transition().duration(animtime).ease("elastic")
      .attr('x1',xscale(0)).attr('y1',yscale(0))
      .attr('x2',function(d){return xscale(d[0])}).attr('y2',function(d){return yscale(d[1])})
      .attr('class','rootarrow')
        
      var fundarrows = canvas.selectAll('.fundarrow').data(fundamentalroots)
      fundarrows.enter().append('line')
        
      fundarrows
      .transition().duration(animtime).ease("elastic")
      .attr('x1',xscale(0)).attr('y1',yscale(0))
      .attr('x2',function(d){return xscale(d[0])}).attr('y2',function(d){return yscale(d[1])})
      .attr('class','fundarrow')
        
        
    }


    // from a CholeskyDecomposition in mathematica
    // cartan matrix has a decomposition: D*S where D is diagonal and
    // S is symmetric. we can Cholesky Decompose S into L^T.L 
    // and the vectors are given by sqrt(D)*L^T
    
    function drawrank3(dynkin){
      d3.select("#canvasbox").selectAll('*').remove();
      if($('#x3dbox').length == 0){
        var scene = d3.select('#canvasbox').append('x3d').attr("id",'x3dbox').append('scene')
        scene.attr('id','the_scene');
        scene.append('viewpoint').attr( "position", "0 0 5" )
      }
      

      var rank3data = 
      {'a3':{
          'simpleroots':[[1,0,0],[-0.5,0.8660254,0],[0., -0.57735, 0.816497]],
          'cartanmatrix':[[2,-1,0],[-1,2,-1],[0,-1,2]]},
        'b3':{
          'simpleroots':[[1,0,0],[-0.5,0.8660254,0],[0., -0.57735, 0.408248]],
          'cartanmatrix':[[2,-1,0],[-1,2,-1],[0,-2,2]]
        },
        'c3':{
          'simpleroots':[[1,0,0],[-0.5,0.8660254,0],[0., -1.1547, 0.816497]],
          'cartanmatrix':[[2,-1,0],[-1,2,-2],[0,-1,2]]
        },
      }
      
      var simpleroots3d = rank3data[dynkin]['simpleroots']
      var cartanmatrixd3d = rank3data[dynkin]['cartanmatrix']

      var rootlattice3d = _.range(-3,4).map(function(i){return _.range(-3,4).map(function(j){return _.range(-3,4).map(function(k){
        return numeric.add(numeric.mul(i,simpleroots3d[0]),numeric.mul(j,simpleroots3d[1]),numeric.mul(k,simpleroots3d[2]))
      })})})
      var rootlattice3d = _.flatten(rootlattice3d,1)
      var rootlattice3d = _.flatten(rootlattice3d,1)

      var fundamentalroots3d = numeric.dot(numeric.inv(cartanmatrixd3d),simpleroots3d)

      var fundlattice3d = _.range(-4,5).map(function(i){return _.range(-4,5).map(function(j){return _.range(-4,5).map(function(k){
        return numeric.add(numeric.mul(i,fundamentalroots3d[0]),numeric.mul(j,fundamentalroots3d[1]),numeric.mul(k,fundamentalroots3d[2]))
      })})})
      var fundlattice3d = _.flatten(fundlattice3d,1)
      var fundlattice3d = _.flatten(fundlattice3d,1)

      var root3dspheres = d3.select('#the_scene').selectAll('.sphere').data(rootlattice3d)
      root3dspheres.enter().append('transform').attr('class','rootblob')
      .append('shape')
      .each(function(){
        d3.select(this).append('appearance').append('material')
        .attr('diffuseColor','steelblue')
        .attr('transparency',0.5)
        d3.select(this).append('sphere').attr('radius',0.02)
      })
    
      d3.selectAll('.rootblob').attr('translation',function(d){return d.join(' ')})
    
      var fundamental3dspheres = d3.select('#the_scene').selectAll('.sphere').data(fundlattice3d)
      fundamental3dspheres.enter().append('transform').attr('class','fundblob')
      .append('shape')
      .each(function(d){
        d3.select(this).append('appearance').append('material').attr('diffuseColor','#995555')
        d3.select(this).append('sphere').attr('radius',0.01)
      })
      
      d3.selectAll('.fundblob').attr('translation',function(d){return d.join(' ')})
      

      var all3droots = allroots(simpleroots3d)

      
      
      rootlines = d3.select('#the_scene').selectAll('.rootline').data(all3droots).enter().append('shape').attr('class','rootline')
      rootlines = d3.select('#the_scene').selectAll('.rootline')
      rootlines.append('appearance').append('material').attr('emissiveColor','steelblue')
      rootlines.append('lineset').attr('color','steelblue').append('coordinate')
      .attr('point',function(d){return '0 0 0 '+d.join(' ')})

      fundlines = d3.select('#the_scene')
      .selectAll('.fundline').data(fundamentalroots3d).enter().append('shape').attr('class','fundline')
      fundlines = d3.select('#the_scene').selectAll('.fundline')
      fundlines.append('appearance').append('material').attr('emissiveColor','#995555')
      fundlines.append('lineset')
      .append('coordinate').attr('point',function(d){return '0 0 0 '+d.join(' ')})

      
      x3dom.reload()
    }
    </script>
  </body>
  </html>