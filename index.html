<html>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" 
  href="http://www.x3dom.org/x3dom/release/x3dom.css">
</link>
<script type="text/javascript" 
src="http://www.x3dom.org/x3dom/release/x3dom.js">
</script>
<script src="node_modules/d3/d3.js" charset="utf-8"></script>
<script src="node_modules/underscore/underscore.js" charset="utf-8"></script>
<script src="node_modules/js-combinatorics/combinatorics.js"></script>
<script src="js/m4th.min.js"></script>
<script src="js/numeric-1.2.6.min.js" charset="utf-8"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<style type="text/css" media="screen">
body{
  background-color:#eee;
  margin:auto; 
  color:#111;
  font-family:Helvetica;
}
.coord{
  fill:#eee;
}
.root{
  fill:none;
  stroke:steelblue;
  stroke-width:3;
}

.repmarker{
  fill:none;
  stroke:#559955;
  stroke-width:4;
}


.rootarrow{
  stroke-width:1;
  stroke-dasharray: 5,5;
  stroke:steelblue;
}
.fundamental{
  fill:#995555;
}
.fundarrow{
  stroke-width:1;
  stroke:#995555;
}

.edge{
  stroke-width:1;
  stroke:#559955;
}

#content{
  font-size:120%;
  opacity:.75;
  height:100%;
  background-color:#eee;
  margin:auto;      
  position:fixed;
  overflow:scroll;
  z-index:1;
  padding:2em;
  width:300px;
}
#canvas{
   width:100%;
   height:100%
}
#canvasbox{
  overflow-x:hidden;
  overflow-y:hidden;
  margin:auto;
  height:100%;
  width:100%;
  /*      display: table;*/
}
#legend td{
}
#legend svg{
  vertical-align: middle;
}

.dynkindiagram img{
  vertical-align: middle;  
  padding:0;
  margin:0;
}

.algname{
  font-size: 140%;
}

.dynkin{
  background-color:#eee;
}

#x3dbox{
  width:100%;
  height:100%;
  border:1px solid black;
}

</style>
<title>Lie Algebras of Rank 2 and 3</title>
</head>
<body>
<div id="content">
  <h1>Lattices of Lie Algebras of Rank Two and Three</h1>
  <p>
    Select Dynkin Diagram.
    <form>
      <input type="radio" name="lie" onclick="drawlattices(1*Math.PI/2,Math.sqrt(1));">    
      <span class="dynkindiagram">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/9/9a/Dyn-2.png" width="6" height="24" data-file-width="6" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> <span class='algname'>ùñòùî¨‚ÇÑ</span>
    
      <input type="radio" name="lie" onclick="drawlattices(2*Math.PI/3,Math.sqrt(1));">
      <span class="dynkindiagram">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/c/c8/Dyn2-3.png" width="6" height="24" data-file-width="6" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> <span class='algname'>ùñòùî©‚ÇÉ</span>
    
      <br/>
    
      <input type="radio" name="lie" onclick="drawlattices(3*Math.PI/4,Math.sqrt(2));">
      <span class="dynkindiagram">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/4/48/Dyn2-4a.png" width="8" height="24" data-file-width="8" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> <span class='algname'>ùñòùî≠‚ÇÑ</span>

      <input type="radio" name="lie" onclick="drawlattices(5*Math.PI/6,Math.sqrt(3));">
      <span class="dynkindiagram" class="dynkin">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/3/38/Dyn2-6a.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> <span class='algname'>ùî§‚ÇÇ</span>
      <br/>

      <input type="radio" name="lie" onclick="drawrank3('a3');">
      <span class="dynkindiagram">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/c/c8/Dyn2-3.png" width="8" height="24" data-file-width="8" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/c/c8/Dyn2-3.png" width="6" height="24" data-file-width="6" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> <span class='algname'>ùñòùî¨‚ÇÜ‚âÉ ùñòùî©‚ÇÑ</span>
      <br/>
      <input type="radio" name="lie" onclick="drawrank3('b3');">
      <span class="dynkindiagram">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/4/48/Dyn2-4a.png" width="8" height="24" data-file-width="8" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/c/c8/Dyn2-3.png" width="6" height="24" data-file-width="6" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> <span class='algname'>ùñòùî¨‚Çá</span>
      <br/>
      <input type="radio" name="lie" onclick="drawrank3('c3');">
      <span class="dynkindiagram">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/a/a0/Dyn2-4b.png" width="8" height="24" data-file-width="8" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/c/c8/Dyn2-3.png" width="6" height="24" data-file-width="6" data-file-height="24">
        <img src="http://upload.wikimedia.org/wikipedia/commons/f/fb/Dyn2-node.png" width="9" height="24" data-file-width="9" data-file-height="24">
      </span> <span class='algname'>ùñòùî≠‚ÇÜ</span>
      
    </form>
  </p>      
  <p>
    This small demo will draw the fundamental weight lattice as well as the root lattice of the semi-simple Lie algebra associated to the selected Dynkin diagram. For the rank three algebras, WebGL must be enabled to view it (Google Chrome does this by default.)
  </p>
  <p>    
    Legend:
    <div id="legend">
      <table>
        <tr><td><svg width=20 height=20><circle cx=10 cy=10 r=2 class="fundamental"></circle></svg>weight</td></tr>
        <tr><td><svg width=20 height=20><circle cx=10 cy=10 r=5 class="root"></circle></svg> root lattice weight</td></tr>
        <tr><td><svg width=20 height=20><circle cx=10 cy=10 r=7 class="repmarker"></circle></svg> fundamental rep weight</td></tr>
        <tr><td><svg width=20 height=20><line x1=0 y1=10 x2=20 y2=10 class="rootarrow"></circle></svg> root</td></tr>
        <tr><td><svg width=20 height=20><line x1=0 y1=10 x2=20 y2=10 class="fundarrow"></circle></svg> fundamental dominant weight</td></tr>
        </table>
      </div>

    </p>
    <p>
    Various things can be deduced by eye. The index of the root lattice as a sublattice of the fundamental lattice is the center of the universally covering group with that Lie Algebra.
    For G2, for example, we see that the group is centerless. For Spin(4) which has so4 Lie algebra, the center is ‚Ñ§‚ÇÇ√ó‚Ñ§‚ÇÇ (we can see from the lattices that it must be a finite abelian group of 4 elements, so i could be ‚Ñ§‚ÇÑ or ‚Ñ§‚ÇÇ√ó‚Ñ§‚ÇÇ). Also for ùñòùî©‚ÇÉ we see that the index of the root lattice and weight lattice is 3. I.e. the center of ùñòùî©‚ÇÉ is ‚Ñ§‚ÇÉ. Additionally we can only quotient out the entire center since 3 is a prime number already. Therefore there are no intermediate groups between the universal cover and the centerless adjoint group. Finally for ùñòùî≠‚ÇÑ we see that the root lattice is twice as large, i.e. the center of Sp(4,‚ÑÇ) is ‚Ñ§‚ÇÇ.
      </p>
    </p>
    All Groups with the same Lie algebra are constructed as quotients of the universal cover by some central subgroup. I.e. Spin(4,‚ÑÇ) has center ‚Ñ§‚ÇÇ√ó‚Ñ§‚ÇÇ. Quotienting out ‚Ñ§‚ÇÇ we get SO(4,‚ÑÇ) which has fundamental group (first homotopy group ‚Ñ§‚ÇÇ), i.e. exactly what we quotiented out. and center ‚Ñ§‚ÇÇ, i.e. what's left of the center. Quotienting out the entire Center of the group we arrive at the (now centerless) Adjoint group, whose weight lattice is exactly the root lattice.
    <p>    

    contact: lukas.heinrich (at) cern.ch
    </div>
    <div id="canvasbox">
    </div>

    <script type="text/javascript" charset="utf-8">

    function cartanelement(beta,alpha){
      if(numeric.dot(alpha,alpha) < 0.01){return 0;}
      return Math.round(2*numeric.dot(beta,alpha)/numeric.dot(alpha,alpha))
    }
    
    function vecinlist(vec,list){
      for(var i=0;i<list.length;i++){
        if(numeric.norm2(numeric.add(vec,numeric.mul(-1,list[i]))) < 0.01){return true;}
      }
      return false
    }
    
    function reflectweyl(points,roots){
      while(true){
        var newpoints = []
        for(var i=0;i<roots.length;i++){
          //reflect all points over root i
          for(var j=0;j<points.length;j++){
            var a = numeric.transpose([points[j]])
            var rooti = numeric.transpose([roots[i]])
            var reflected = numeric.transpose(numeric.sub(a,numeric.mul(2*numeric.dot(numeric.transpose(a),rooti)/numeric.dot(numeric.transpose(rooti),rooti),rooti)))[0]
            if(!vecinlist(reflected,points) && !vecinlist(reflected,newpoints)){
              newpoints.push(reflected)
            }
          }
        }
        if(!newpoints.length){break;}
        points = points.concat(newpoints)
      }
      return points      
    }
    
    function allroots(simpleroots){
      var roots = simpleroots
      while(true){
        newroots = []
        for(var i=0;i<roots.length;i++){
          var negroot = numeric.mul(-1,roots[i])
          if(!vecinlist(negroot,roots)){roots.push(negroot)}
          //reflect all roots over root i and add string of roots
          for(var j=0;j<roots.length;j++){
            if(Math.abs(1-Math.abs(numeric.dot(roots[i],roots[j])/numeric.norm2(roots[i])/numeric.norm2(roots[j])))>0.1){
              nreflect = cartanelement(roots[i],roots[j])
              for(var k=1;k<Math.abs(nreflect)+1;k++){
                reflected = numeric.add(roots[i],numeric.mul(nreflect > 0 ? -k : k,roots[j]))
                if(reflected[0] == 0 && reflected[1] == 0){
                  debugger;
                }
                if(!vecinlist(reflected,roots) && !vecinlist(reflected,newroots)){
                  newroots.push(reflected)
                }
              }
            }
          }
        }
        if(!newroots.length){break;}
        roots = roots.concat(newroots)
      }
      return roots
    }

    function rotate(angle){
      return [[Math.cos(angle),-Math.sin(angle)],[Math.sin(angle),Math.cos(angle)]];
    }
    
    function orient(facevects,x,debug){
      var facediffs = _.map(_.range(1,facevects.length),function(i){return numeric.sub(facevects[0],facevects[i])});
      var orient = numeric.det(_.map(facediffs.concat([numeric.sub(x,facevects[0])]),function(x){return numeric.transpose(x)[0]}))
      if(Math.abs(orient)<0.01) orient = 0;
      return orient;
    }

    function convexedges(hullvertices){
      var cmb = Combinatorics.combination(_.range(hullvertices.length),hullvertices[0].length).toArray()
      var edges = _.map(cmb,function(d){return _.map(d,function(x){return numeric.transpose([hullvertices[x]])});})
      var vertices = _.map(hullvertices,function(x){return numeric.transpose([x])})
      return _.filter(_.map(edges,function(edge){return [edge,_.uniq(_.map(vertices,function(x){return Math.sign(orient(edge,x))}))]}),function(edge_sign){return edge_sign[1].length <= 2})      
    } 

    function lowerconvex(convex,testpoint,vertices){
      var facevects = convex[0][0]
      var facediffs = _.map(_.range(1,facevects.length),function(i){return numeric.sub(facevects[0],facevects[i])});
      var transposediffs = _.map(facediffs,function(x){return numeric.transpose(x)[0]})
      var newbasis = transposediffs.concat([normalvec(transposediffs)])
      var newcoords = numeric.dot(numeric.inv(newbasis),testpoint)
      var newtestpoint = newcoords.slice(0,testpoint.length-1)
      var newvertices = _.map(vertices,function(x){return numeric.dot(numeric.inv(newbasis),x).slice(0,testpoint.length-1)})

      if(Math.abs(newcoords.slice(-1)[0]) > 0.01){return false;}

      var newhull = _.map(newvertices,function(x){return numeric.transpose(x)[0]})
      return isinside(convexedges(newhull),newtestpoint)
    }

    function isinside(convex,x,vertices){
      if(convex.length==1) return lowerconvex(convex,x,vertices)
      return _.every(_.map(convex,function(edge_sign){return $.inArray(Math.sign(orient(edge_sign[0],x)),edge_sign[1])!=-1}))
    }
    
    function getlattices(fundweights,fundrange,simpleroots,rootrange){
      var lincombsroot = Combinatorics.cartesianProduct.apply(this,_.map(_.range(simpleroots.length),function(x){return _.range.apply(this,rootrange)})).toArray()
      var rootgrid = _.map(lincombsroot,function(x){return numeric.dot(x,simpleroots)})

      var lincombsfund = Combinatorics.cartesianProduct.apply(this,_.map(_.range(fundweights.length),function(x){return _.range.apply(this,fundrange)})).toArray()
      var fundamentalgrid = _.map(lincombsfund,function(x){return numeric.dot(x,fundweights)})
      return [fundamentalgrid,rootgrid]
    }
    
    function getalgebradata(simpleroots,fundrange,rootrange){
      var fundweights = numeric.dot(numeric.inv(getcartanmatrix(simpleroots)),simpleroots)
      var lattices = getlattices(fundweights,fundrange,simpleroots,rootrange)
      var roots = allroots(simpleroots)
      return {'lattices':lattices,'fundweights':fundweights,'roots':roots,'simpleroots':simpleroots}
    }
    
    function getrepweights(highestcoeff,fundamentalweights,roots,simpleroots){
      var rank = fundamentalweights.length;
      var highestweight = numeric.dot(highestcoeff,fundamentalweights)
      var rephullvertices = reflectweyl([highestweight],roots)

      var vertices = _.map(rephullvertices,function(x){return numeric.transpose([x])})

      var convex = convexedges(rephullvertices,vertices);

      var lincombs = Combinatorics.cartesianProduct.apply(this,_.map(_.range(rank),function(x){return _.range(-10,10)})).toArray()

      var candidategrid = _.map(lincombs,function(x){return numeric.add(highestweight,numeric.dot(x,simpleroots))})

      isinside(convex,[[2],[0]],vertices)

      var repweights = _.filter(candidategrid,function(x){return isinside(convex,numeric.transpose([x]),vertices)})
      return [repweights,convex]
    }
    
    //basisvecs = [[[1],[1]],[[1],[0]]]
    //basismatrix = _.map(basisvecs,function(x){return numeric.transpose(x)[0]})
    //coordinates = numeric.dot(numeric.inv(basismatrix),[[2],[3]])
    
    //basisvecs2 = [[1,1],[1,0]]
    //numeric.dot(numeric.transpose(numeric.dot(numeric.inv(basismatrix),[[2],[3]]))[0],basisvecs2)
    //>> [2, 3]


    //

    ///
    /// DRAWING
    ///
    
    function normalvec(nmin1vecs){
      var dim = nmin1vecs[0].length
      var orthobasis = _.map(_.range(dim),function(x){v=_.map(_.range(dim),function(){return 0});v[x]=1;return v})
      return _.map(orthobasis,function(x){return numeric.det([x].concat(nmin1vecs))})
    }


    function getcartanmatrix(simpleroots){
      return _.range(simpleroots.length).map(function(i){return _.range(simpleroots.length).map(function(j){
        return 2*numeric.dot(simpleroots[i],simpleroots[j])/numeric.dot(simpleroots[j],simpleroots[j]);
      })})
    }
    
    function drawlattices(angle,scale){
      var physwidth = 10
      var a1 = [1,0]
      var a2 = numeric.mul(scale,numeric.dot(rotate(angle),a1))
     
      var simpleroots = [a1,a2]

      var fundrange = [-physwidth,physwidth]
      var rootrange = [-physwidth,physwidth]      
      var algebradata = getalgebradata(simpleroots,fundrange,rootrange)
      drawrank2_impl(algebradata)
    }
    
    function drawrank3(dynkin){
      // from a CholeskyDecomposition in mathematica
      // cartan matrix has a decomposition: D*S where D is diagonal and
      // S is symmetric. we can Cholesky Decompose S into L^T.L 
      // and the vectors are given by sqrt(D)*L^T
    
      var rank3data = 
      {'a3':{
          'simpleroots':[[1,0,0],[-0.5,0.8660254,0],[0., -0.57735, 0.816497]],
          'cartanmatrix':[[2,-1,0],[-1,2,-1],[0,-1,2]]},
        'b3':{
          'simpleroots':[[1,0,0],[-0.5,0.8660254,0],[0., -0.57735, 0.408248]],
          'cartanmatrix':[[2,-1,0],[-1,2,-2],[0,-1,2]]
        },
        'c3':{
          'simpleroots':[[1,0,0],[-0.5,0.8660254,0],[0., -1.1547, 0.816497]],
          'cartanmatrix':[[2,-1,0],[-1,2,-1],[0,-2,2]]
        },
      }
      
      var simpleroots = rank3data[dynkin]['simpleroots']
      var fundrange = [-4,5]
      var rootrange = [-3,4]      
      var algebradata = getalgebradata(simpleroots,fundrange,rootrange)
      drawrank3_impl(algebradata)
    }
    
    function drawrank2_impl(algebradata){
      d3.selectAll('x3d').remove()
      if($('#canvas').length == 0){
        d3.select('#canvasbox').append('svg').attr('id','canvas')
      }
      var canvas = d3.selectAll('#canvas')

      var pxwidth   = $('#canvas').width()
      var pxheight   = $('#canvas').height()

      var physwidth = 10
      var physheight = physwidth/pxwidth*pxheight

      var xscale = d3.scale.linear().domain([-physwidth/2,physwidth/2]).range([0,pxwidth]);
      var yscale = d3.scale.linear().domain([-physheight/2,physheight/2]).range([pxheight,0]);

      var fundamentalgrid = algebradata['lattices'][0]
      var rootgrid = algebradata['lattices'][1]
      var roots = algebradata['roots']
      var simpleroots = algebradata['simpleroots']
      var fundweights = algebradata['fundweights']
      
      animtime = 750
     
      var fundamentalmarker = canvas.selectAll('.fundamental').data(fundamentalgrid)
      fundamentalmarker.enter().append('circle')

      fundamentalmarker
      .transition().duration(animtime).ease("elastic")
      .attr('cx',function(d){return xscale(d[0])})
      .attr('cy',function(d){return yscale(d[1])})
      .attr('r',2)
      .attr('class','fundamental')
               
      var rootsmarker = canvas.selectAll('.root').data(rootgrid)
      rootsmarker.enter().append('circle')
        
      rootsmarker
      .attr('cx',function(d){return xscale(d[0])})
      .attr('cy',function(d){return yscale(d[1])})
      .attr('r',5)
      .attr('class','root');
        
      var rootarrows = canvas.selectAll('.rootarrow').data(roots)
      rootarrows.enter().append('line')
      rootarrows.exit().remove()
        
      rootarrows
      .transition().duration(animtime).ease("elastic")
      .attr('x1',xscale(0)).attr('y1',yscale(0))
      .attr('x2',function(d){return xscale(d[0])}).attr('y2',function(d){return yscale(d[1])})
      .attr('class','rootarrow')
        
      var fundarrows = canvas.selectAll('.fundarrow').data(fundweights)
      fundarrows.enter().append('line')
        
      fundarrows
      .transition().duration(animtime).ease("elastic")
      .attr('x1',xscale(0)).attr('y1',yscale(0))
      .attr('x2',function(d){return xscale(d[0])}).attr('y2',function(d){return yscale(d[1])})
      .attr('class','fundarrow')
      
      drawrep2d(getrepweights([1,0],fundweights,roots,simpleroots))
    }
            
    function drawrep2d(data){
      var repweights = data[0]
      var convexedges = data[1]
      var justedges = _.map(convexedges,function(x){return x[0]})

      var canvas = d3.selectAll('#canvas')

      var pxwidth   = $('#canvas').width()
      var pxheight   = $('#canvas').height()

      var physwidth = 10
      var physheight = physwidth/pxwidth*pxheight

      var xscale = d3.scale.linear().domain([-physwidth/2,physwidth/2]).range([0,pxwidth]);
      var yscale = d3.scale.linear().domain([-physheight/2,physheight/2]).range([pxheight,0]);

      var repmarker = canvas.selectAll('.repmarker').data(repweights)
      repmarker.enter().append('circle')
      repmarker.exit().remove()
      repmarker
      .transition().duration(animtime).ease("elastic")
      .attr('cx',function(d){return xscale(d[0])})
      .attr('cy',function(d){return yscale(d[1])})
      .attr('r',10)
      .attr('class','repmarker');

     canvas.selectAll('.edge').data(justedges).enter()
                               .append('line')
                               .attr('class','edge')

      canvas.selectAll('.edge').data(justedges).exit().remove()

      canvas.selectAll('.edge').data(justedges)
            .transition().duration(animtime).ease("elastic")
            .attr('x1',function(d){return xscale(d[0][0])})
            .attr('y1',function(d){return yscale(d[0][1])})
            .attr('x2',function(d){return xscale(d[1][0])})
            .attr('y2',function(d){return yscale(d[1][1])})
    }
    
    function drawrep3d(data){
      var repweights = data[0]
      var convexedges = data[1]
      var scene = d3.select('#canvasbox').append('x3d').attr("id",'x3dbox').append('scene')

      var repspheres = d3.select('#the_scene').selectAll('.sphere').data(repweights)
      repspheres.enter().append('transform').attr('class','repblob')
      .append('shape')
      .each(function(){
        d3.select(this).append('appearance').append('material')
        .attr('diffuseColor','#559955')
        .attr('transparency',0.2)
        d3.select(this).append('sphere').attr('radius',0.04)
      })
    
      d3.selectAll('.repblob').attr('translation',function(d){return d.join(' ')})
   }
    
    function drawrank3_impl(algebradata){
      d3.select("#canvasbox").selectAll('*').remove();
      if($('#x3dbox').length == 0){
        var scene = d3.select('#canvasbox').append('x3d').attr("id",'x3dbox').append('scene')
        scene.attr('id','the_scene');
        scene.append('viewpoint').attr( "position", "0 0 5" )
        // .attr( "position", "5 0 0" )
        // .attr('orientation','0 1 0 1.57079633')
      }
      
      var fundamentalgrid = algebradata['lattices'][0]
      var rootgrid = algebradata['lattices'][1]
      var roots = algebradata['roots']
      var simpleroots = algebradata['simpleroots']
      var fundweights = algebradata['fundweights']
      

      var root3dspheres = d3.select('#the_scene').selectAll('.sphere').data(rootgrid)
      root3dspheres.enter().append('transform').attr('class','rootblob')
      .append('shape')
      .each(function(){
        d3.select(this).append('appearance').append('material')
        .attr('diffuseColor','steelblue')
        .attr('transparency',0.2)
        d3.select(this).append('sphere').attr('radius',0.02)
      })
    
      d3.selectAll('.rootblob').attr('translation',function(d){return d.join(' ')})
    
      var fundamental3dspheres = d3.select('#the_scene').selectAll('.sphere').data(fundamentalgrid)
      fundamental3dspheres.enter().append('transform').attr('class','fundblob')
      .append('shape')
      .each(function(d){
        d3.select(this).append('appearance').append('material').attr('diffuseColor','#995555')
        d3.select(this).append('sphere').attr('radius',0.01)
      })
      
      d3.selectAll('.fundblob').attr('translation',function(d){return d.join(' ')})
      
      var rootlines = d3.select('#the_scene').selectAll('.rootline').data(roots).enter().append('shape').attr('class','rootline')
      rootlines = d3.select('#the_scene').selectAll('.rootline')
      rootlines.append('appearance').append('material').attr('emissiveColor','steelblue')
      rootlines.append('lineset').attr('color','steelblue').append('coordinate')
      .attr('point',function(d){return '0 0 0 '+d.join(' ')})

      var fundlines = d3.select('#the_scene')
      .selectAll('.fundline').data(fundweights).enter().append('shape').attr('class','fundline')
      fundlines = d3.select('#the_scene').selectAll('.fundline')
      fundlines.append('appearance').append('material').attr('emissiveColor','#995555')
      fundlines.append('lineset')
      .append('coordinate').attr('point',function(d){return '0 0 0 '+d.join(' ')})

      drawrep3d(getrepweights([1,0,0],fundweights,roots,simpleroots))


      x3dom.reload()
    }
    </script>
  </body>
  </html>